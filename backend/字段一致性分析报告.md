# 字段一致性分析报告

## 📊 当前状态

### 1. monthly_basic_info 表字段（24个）

#### 罪犯构成（19个）
- total_prisoners - 在押罪犯总数
- major_criminals - 重大刑事犯
- death_sentence - 死缓犯
- life_sentence - 无期犯
- repeat_offenders - 二次以上判刑罪犯
- foreign_prisoners - 外籍犯
- hk_macao_taiwan - 港澳台罪犯
- mental_illness - 精神病犯
- former_officials - 原地厅以上罪犯
- former_county_level - 原县团级以上罪犯
- falun_gong - 法轮功
- drug_history - 有吸毒史罪犯
- drug_crimes - 涉毒犯
- new_admissions - 新收押罪犯
- minor_females - 未成年女犯
- gang_related - 涉黑罪犯
- evil_forces - 涉恶罪犯
- endangering_safety - 危安罪犯
- released_count - 刑满释放出监罪犯

#### 违纪统计（4个）
- recorded_punishments - 记过人数
- recorded_punishments_reason - 记过原因
- confinement_punishments - 禁闭人数
- confinement_reason - 禁闭原因

#### 信件统计（1个）
- letters_received - 收到信件数量

### 2. 报告预览页面可编辑字段（45个）

#### 一、本月基本情况（23个）
✅ 全部在 monthly_basic_info 表中

#### 二、执法检察情况（9个）
❌ 全部不在 monthly_basic_info 表中：
- paroleBatch - 减刑批次
- paroleCount - 减刑案件数
- paroleStage - 减刑阶段
- correctionNotices - 纠正违法通知书
- correctionIssues - 纠正违法问题
- threeSceneChecks - 三大现场检察
- keyLocationChecks - 重点场所检察
- visitChecks - 会见检察
- visitIllegalCount - 会见违法问题

#### 三、安全防范检察（2个）
❌ 全部不在 monthly_basic_info 表中：
- monitorChecks - 监控检察
- issuesFound - 发现问题

#### 四、个别谈话（6个）
❌ 全部不在 monthly_basic_info 表中：
- totalTalks - 谈话总数
- newAdmissionTalks - 新收押谈话
- evilForcesTalks - 涉恶谈话
- injuryTalks - 外伤谈话
- confinementTalks - 禁闭谈话
- questionnaireCount - 问卷调查

#### 五、会议活动（3个）
❌ 全部不在 monthly_basic_info 表中：
- lifeSentenceReviews - 无期死缓评审会
- analysisMeetings - 犯情分析会
- otherActivities - 其他活动

#### 六、其他工作（2个）
- mailboxOpens - 开启信箱 ❌ 不在表中
- lettersReceived - 收到信件 ✅ 在表中

### 3. 报告清单页面
- 报告清单页面没有直接编辑字段，只是显示16项标准报告事项
- 清单数据保存在 `checklist_items` 表中

## ⚠️ 问题总结

1. **数据库字段数**: 24个
2. **报告预览可编辑字段数**: 45个
3. **差异**: 21个字段不在 monthly_basic_info 表中

## 💡 解决方案

根据用户要求："报告预览中所有可编辑的字段 = monthly_basic_info 表的字段"

### 方案1：扩展 monthly_basic_info 表（推荐）

将缺失的21个字段添加到 monthly_basic_info 表中：

```sql
-- 执法检察情况（9个字段）
ALTER TABLE monthly_basic_info ADD COLUMN parole_batch VARCHAR(50) COMMENT '减刑批次';
ALTER TABLE monthly_basic_info ADD COLUMN parole_count INT DEFAULT 0 COMMENT '减刑案件数';
ALTER TABLE monthly_basic_info ADD COLUMN parole_stage VARCHAR(50) COMMENT '减刑阶段';
ALTER TABLE monthly_basic_info ADD COLUMN correction_notices INT DEFAULT 0 COMMENT '纠正违法通知书';
ALTER TABLE monthly_basic_info ADD COLUMN correction_issues TEXT COMMENT '纠正违法问题';
ALTER TABLE monthly_basic_info ADD COLUMN three_scene_checks INT DEFAULT 0 COMMENT '三大现场检察';
ALTER TABLE monthly_basic_info ADD COLUMN key_location_checks INT DEFAULT 0 COMMENT '重点场所检察';
ALTER TABLE monthly_basic_info ADD COLUMN visit_checks INT DEFAULT 0 COMMENT '会见检察';
ALTER TABLE monthly_basic_info ADD COLUMN visit_illegal_count INT DEFAULT 0 COMMENT '会见违法问题';

-- 安全防范检察（2个字段）
ALTER TABLE monthly_basic_info ADD COLUMN monitor_checks INT DEFAULT 0 COMMENT '监控检察';
ALTER TABLE monthly_basic_info ADD COLUMN issues_found INT DEFAULT 0 COMMENT '发现问题';

-- 个别谈话（6个字段）
ALTER TABLE monthly_basic_info ADD COLUMN total_talks INT DEFAULT 0 COMMENT '谈话总数';
ALTER TABLE monthly_basic_info ADD COLUMN new_admission_talks INT DEFAULT 0 COMMENT '新收押谈话';
ALTER TABLE monthly_basic_info ADD COLUMN evil_forces_talks INT DEFAULT 0 COMMENT '涉恶谈话';
ALTER TABLE monthly_basic_info ADD COLUMN injury_talks INT DEFAULT 0 COMMENT '外伤谈话';
ALTER TABLE monthly_basic_info ADD COLUMN confinement_talks INT DEFAULT 0 COMMENT '禁闭谈话';
ALTER TABLE monthly_basic_info ADD COLUMN questionnaire_count INT DEFAULT 0 COMMENT '问卷调查';

-- 会议活动（3个字段）
ALTER TABLE monthly_basic_info ADD COLUMN life_sentence_reviews INT DEFAULT 0 COMMENT '无期死缓评审会';
ALTER TABLE monthly_basic_info ADD COLUMN analysis_meetings INT DEFAULT 0 COMMENT '犯情分析会';
ALTER TABLE monthly_basic_info ADD COLUMN other_activities TEXT COMMENT '其他活动';

-- 其他工作（1个字段）
ALTER TABLE monthly_basic_info ADD COLUMN mailbox_opens INT DEFAULT 0 COMMENT '开启信箱';
```

### 方案2：保持现状（不推荐）

保持当前设计，但明确告知用户：
- 24个字段来自 monthly_basic_info 表
- 21个字段来自其他表（daily_logs, weekly_records, monthly_records）或前端计算

### 方案3：混合方案

将常用的、需要手动编辑的字段添加到 monthly_basic_info 表，保留自动计算的字段在其他表。

## 🎯 推荐行动

**采用方案1**，理由：
1. 符合用户要求："所有操作都依赖数据库"
2. 简化数据流：所有报告数据都在一个表中
3. 便于编辑：用户编辑后直接 UPDATE 一个表
4. 便于下载：生成Word时只需查询一个表
5. 数据一致性：避免多表数据不同步的问题

## 📝 实施步骤

1. 创建 SQL 脚本添加21个字段
2. 更新 MonthlyBasicInfo 模型定义
3. 更新前端 store 的 basicInfo 对象
4. 更新报告预览页面的保存逻辑
5. 更新下载报告的数据查询逻辑
6. 测试所有功能

## ✅ 预期结果

实施后：
- monthly_basic_info 表：45个字段（24 + 21）
- 报告预览可编辑字段：45个
- 数据一致性：100%
- 所有操作都依赖数据库：✅
