# 测试文件说明

## 测试数据概览

本目录包含6个测试文件的数据说明，用于测试报告预览和清单功能。

### 数据汇总

| 文件 | 记录数 | 说明 |
|------|--------|------|
| 涉黑恶名单.xls | 5条 | 3个涉黑，2个涉恶 |
| 禁闭审批.xlsx | 3条 | 3人禁闭处分 |
| 严管教育审批.xlsx | 4条 | 4人严管教育 |
| 戒具使用审批.xlsx | 2条 | 2人使用戒具 |
| 信件汇总.xlsx | 8条 | 8封信件 |
| 犯情动态.docx | 1份 | 月度犯情分析 |

## 快速测试

### 方法1：使用脚本直接插入数据库（推荐）

```bash
cd backend
node scripts/insert-test-data.js
```

执行后会自动创建所有测试数据到数据库，然后可以直接在前端查看报告预览。

### 方法2：手动创建Excel文件上传

按照下面的数据说明，手动创建Excel文件，然后通过前端"材料上传"页面上传。

---

## 1. 涉黑恶名单.xls

**文件名：** `涉黑恶名单.xls`

**表头：**
| 罪犯编号 | 姓名 | 性别 | 民族 | 出生日期 | 籍贯 | 捕前面貌 | 原判罪名 | 原判刑期 | 刑期起日 | 刑期止日 | 入监日期 | 三涉情况 | 在押现状 | 刑罚变动情况 |

**数据：**

| 罪犯编号 | 姓名 | 性别 | 三涉情况 | 原判罪名 |
|---------|------|------|---------|---------|
| BL001 | 张三 | 男 | 涉黑 | 组织、领导黑社会性质组织罪 |
| BL002 | 李四 | 男 | 涉黑 | 参加黑社会性质组织罪 |
| BL003 | 王五 | 男 | 涉黑 | 包庇、纵容黑社会性质组织罪 |
| BL004 | 赵六 | 女 | 涉恶 | 寻衅滋事罪 |
| BL005 | 孙七 | 女 | 涉恶 | 强迫交易罪 |

**预期统计结果：**
- 涉黑罪犯：3人
- 涉恶罪犯：2人

---

## 2. 禁闭审批.xlsx

**文件名：** `禁闭审批.xlsx`

**表头：**
| 罪犯编号 | 制单时间 | 禁闭起日 | 禁闭止日 | 适用条款 | 违规事实 | 业务状态 |

**数据：**

| 罪犯编号 | 制单时间 | 禁闭起日 | 禁闭止日 | 适用条款 | 违规事实 | 业务状态 |
|---------|---------|---------|---------|---------|---------|---------|
| CF001 | 2026-01-05 | 2026-01-05 | 2026-01-12 | 《监狱法》第58条 | 殴打他人 | 已审批 |
| CF002 | 2026-01-10 | 2026-01-10 | 2026-01-17 | 《监狱法》第58条 | 拒不服从管理 | 已审批 |
| CF003 | 2026-01-15 | 2026-01-15 | 2026-01-22 | 《监狱法》第58条 | 聚众闹事 | 已审批 |

**预期统计结果：**
- 禁闭处分人数：3人

---

## 3. 严管教育审批.xlsx

**文件名：** `严管教育审批.xlsx`

**表头：**
| 罪犯编号 | 制单时间 | 适用条款 | 严管教育原因 | 严管天数 | 严管起日 | 严管止日 | 业务状态 |

**数据：**

| 罪犯编号 | 制单时间 | 适用条款 | 严管教育原因 | 严管天数 | 严管起日 | 严管止日 | 业务状态 |
|---------|---------|---------|------------|---------|---------|---------|---------|
| SE001 | 2026-01-03 | 《监狱法》第59条 | 违反监规 | 15 | 2026-01-03 | 2026-01-18 | 已审批 |
| SE002 | 2026-01-08 | 《监狱法》第59条 | 不服从管理 | 10 | 2026-01-08 | 2026-01-18 | 已审批 |
| SE003 | 2026-01-12 | 《监狱法》第59条 | 扰乱秩序 | 7 | 2026-01-12 | 2026-01-19 | 已审批 |
| SE004 | 2026-01-20 | 《监狱法》第59条 | 打架斗殴 | 20 | 2026-01-20 | 2026-02-09 | 已审批 |

**预期统计结果：**
- 记过处分人数：4人

---

## 4. 戒具使用审批.xlsx

**文件名：** `戒具使用审批.xlsx`

**表头：**
| 罪犯编号 | 制单时间 | 使用警戒具名称 | 使用条款 | 加戴戒具天数 | 使用起日 | 使用止日 | 业务状态 |

**数据：**

| 罪犯编号 | 制单时间 | 使用警戒具名称 | 使用条款 | 加戴戒具天数 | 使用起日 | 使用止日 | 业务状态 |
|---------|---------|--------------|---------|------------|---------|---------|---------|
| RU001 | 2026-01-06 | 手铐 | 《监狱法》第45条 | 3 | 2026-01-06 | 2026-01-09 | 已审批 |
| RU002 | 2026-01-18 | 脚镣 | 《监狱法》第45条 | 5 | 2026-01-18 | 2026-01-23 | 已审批 |

**预期统计结果：**
- 戒具使用人数：2人

---

## 5. 信件汇总.xlsx

**文件名：** `信件汇总.xlsx`

**表头：**
| 序号 | 开箱日期 | 监区 | 罪犯名字 | 事由 | 类别 | 备注 |

**数据：**

| 序号 | 开箱日期 | 监区 | 罪犯名字 | 事由 | 类别 | 备注 |
|-----|---------|------|---------|------|------|------|
| 1 | 2026-01-05 | 一监区 | 张某某 | 家庭问题咨询 | 一般信件 | |
| 2 | 2026-01-08 | 二监区 | 李某某 | 申诉 | 申诉信件 | 已转相关部门 |
| 3 | 2026-01-10 | 三监区 | 王某某 | 投诉 | 投诉信件 | 已调查处理 |
| 4 | 2026-01-12 | 一监区 | 赵某某 | 生活问题 | 一般信件 | |
| 5 | 2026-01-15 | 二监区 | 孙某某 | 医疗问题 | 一般信件 | |
| 6 | 2026-01-18 | 三监区 | 周某某 | 减刑咨询 | 一般信件 | |
| 7 | 2026-01-22 | 一监区 | 吴某某 | 申诉 | 申诉信件 | 已转相关部门 |
| 8 | 2026-01-25 | 二监区 | 郑某某 | 家属会见问题 | 一般信件 | |

**预期统计结果：**
- 信件数量：8封
- 其中申诉信件：2封
- 投诉信件：1封

---

## 6. 犯情动态.docx（暂不支持）

**文件名：** `XX省XX监狱2025年某月犯情动态.docx`

**说明：** 犯情动态Word文档的解析功能暂未完全实现，建议先测试Excel文件的数据统计功能。

---

## 测试步骤

### 使用脚本测试（推荐）

1. 运行数据插入脚本：
```bash
cd backend
node scripts/insert-test-data.js
```

2. 启动后端服务：
```bash
npm start
```

3. 启动前端服务：
```bash
cd ../front
npm run dev
```

4. 打开浏览器访问前端，登录后：
   - 进入"报告预览"页面
   - 选择"2026年01月"
   - 查看统计数据是否正确

### 手动上传测试

1. 按照上面的数据说明，创建5个Excel文件
2. 登录系统
3. 进入"材料上传"页面
4. 依次上传5个Excel文件
5. 进入"报告预览"页面查看统计结果

---

## 预期结果

在报告预览页面应该看到：

**一、基本情况**
- 涉黑罪犯：3人
- 涉恶罪犯：2人
- 禁闭处分：3人
- 记过处分：4人

**六、其他工作**
- 收到信件：8封

**数据来源标识：**
- 如果显示以上数字，说明Excel数据优先级逻辑正常工作
- 如果数字为0或其他值，说明Excel数据未正确统计

---

## 故障排查

### 数据不显示

1. 检查用户是否设置了`prison_name`：
```bash
node scripts/check-user-prison-name.js
```

2. 检查数据库中是否有数据：
```sql
SELECT COUNT(*) FROM blacklists WHERE prison_name = '女子监狱';
SELECT COUNT(*) FROM confinements WHERE prison_name = '女子监狱';
SELECT COUNT(*) FROM strict_educations WHERE prison_name = '女子监狱';
SELECT COUNT(*) FROM restraint_usages WHERE prison_name = '女子监狱';
SELECT COUNT(*) FROM mail_records WHERE prison_name = '女子监狱';
```

3. 检查API返回：
```bash
# 获取token后
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:3000/api/monthly-basic-info/2026-01
```

### 数据隔离问题

如果看到其他派驻单位的数据，说明数据隔离有问题：

1. 检查数据的`prison_name`字段
2. 检查用户的`prison_name`字段
3. 运行数据隔离测试：
```bash
node scripts/test-data-isolation.js
```

---

## 清理测试数据

测试完成后，可以清理测试数据：

```bash
node scripts/clear-test-data.js
```

或者手动删除：

```sql
DELETE FROM blacklists WHERE prison_name = '女子监狱';
DELETE FROM confinements WHERE prison_name = '女子监狱';
DELETE FROM strict_educations WHERE prison_name = '女子监狱';
DELETE FROM restraint_usages WHERE prison_name = '女子监狱';
DELETE FROM mail_records WHERE prison_name = '女子监狱';
```
