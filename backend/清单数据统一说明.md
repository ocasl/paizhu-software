# 派驻检察工作报告事项清单 - 数据统一说明

## 📋 清单结构

### 数据表：report_checklist_items

| 字段 | 类型 | 说明 | 备注 |
|------|------|------|------|
| id | INT | 主键 | 自增 |
| prison_name | VARCHAR(100) | 监狱名称 | 唯一索引的一部分 |
| year | INT | 年份 | 唯一索引的一部分 |
| month | INT | 月份 | 唯一索引的一部分 |
| item_id | INT | 清单项目ID | 1-16，唯一索引的一部分 |
| **content** | TEXT | **报告内容** | **可编辑** ✏️ |
| **situation** | TEXT | **检察情况** | **可编辑** ✏️ |
| **check_time** | VARCHAR(50) | **记录时间** | **可编辑** ✏️ |
| created_at | DATETIME | 创建时间 | 自动 |
| updated_at | DATETIME | 更新时间 | 自动 |

### 唯一索引
```sql
UNIQUE INDEX (prison_name, year, month, item_id)
```

每个监狱、每个月份、每个项目（1-16）只能有一条记录。

## 📝 16个标准报告事项

| 序号 | 报告事项 | 频率 | 数据来源 |
|------|---------|------|---------|
| 1 | 监狱发生罪犯脱逃、自伤自残、自杀死亡、重大疫情、重大生产安全事故的情况报告 | 及时 | immediate_events |
| 2 | 罪犯死亡事件调查及处理报告 | 及时 | immediate_events |
| 3 | 监狱开展重大监管改造业务活动的情况报告 | 及时 | immediate_events |
| 4 | 监狱民警受到党纪行政处罚情况 | 及时 | immediate_events |
| 5 | 日常检察中要求监管单位大范围整改或调整的工作建议 | 及时 | immediate_events |
| 6 | 监狱提请罪犯减刑、假释、暂予监外执行花名册 | 每批次 | immediate_events |
| 7 | 抽查重点时段、重点环节监控录像发现的情况 | 每日 | daily_logs |
| 8 | 对监狱医院禁闭室检察情况，重点查看警械使用、严管禁闭适用情况 | 每周 | weekly_records |
| 9 | 对监狱医院检察情况，重点排查有无外伤情况 | 每周 | weekly_records |
| 10 | 对刑释前罪犯和新入监罪犯谈话情况 | 每周 | weekly_records |
| 11 | 开启检察官信箱或检察中发现具有价值的案件线索 | 每周 | weekly_records |
| 12 | 检查发现罪犯私藏使用违禁品的情况 | 每周 | weekly_records |
| 13 | 对监狱会见场所检察情况 | 每月 | monthly_records |
| 14 | 参加监狱犯情分析会情况 | 每月 | monthly_records |
| 15 | 对罪犯计分考核、立功奖惩等活动监督情况 | 每月 | monthly_records |
| 16 | 狱内勤杂岗位和辅助生产岗位罪犯每月增减情况 | 每月 | monthly_records |

## 🔄 数据流程

### 1. 编辑清单

```
用户在报告清单页面
   ↓
点击"编辑"按钮
   ↓
修改 content（报告内容）
修改 situation（检察情况）
   ↓
点击"保存"
   ↓
POST /api/checklist-items
   ↓
INSERT or UPDATE report_checklist_items 表
```

### 2. 下载清单

```
用户点击"下载Word"
   ↓
POST /api/reports/generate-checklist
body: { year, month, prison_name }
   ↓
后端从数据库查询清单数据
SELECT * FROM report_checklist_items
WHERE prison_name = ? AND year = ? AND month = ?
   ↓
转换为模板格式
[{ id: 1, content: '...', situation: '...' }, ...]
   ↓
填充Word模板占位符
{content1}, {status1}, {content2}, {status2}, ...
   ↓
返回Word文档
```

## 📄 Word模板占位符

### 模板文件
`backend/muban/派驻检察工作报告事项清单_with_placeholders.docx`

### 占位符格式

```
{prison_name} - 监狱名称
{year} - 年份
{month} - 月份

{content1} - 项目1的报告内容
{status1} - 项目1的检察情况

{content2} - 项目2的报告内容
{status2} - 项目2的检察情况

...

{content16} - 项目16的报告内容
{status16} - 项目16的检察情况
```

总共：3个基本信息 + 16个项目 × 2个字段 = **35个占位符**

## 🔧 API接口

### 1. 查询清单数据
```http
GET /api/checklist-items?prison_name=女子监狱&year=2026&month=2
```

**响应**：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "prison_name": "女子监狱",
      "year": 2026,
      "month": 2,
      "item_id": 1,
      "content": "本月无此类事件",
      "situation": "未发现异常",
      "check_time": "2026-02-28"
    },
    ...
  ]
}
```

### 2. 保存清单项目
```http
POST /api/checklist-items
Content-Type: application/json

{
  "prison_name": "女子监狱",
  "year": 2026,
  "month": 2,
  "item_id": 7,
  "content": "本月共抽查监控 15 次",
  "situation": "未发现异常",
  "check_time": "2026-02-28"
}
```

**响应**：
```json
{
  "success": true,
  "message": "保存成功"
}
```

### 3. 生成清单Word文档
```http
POST /api/reports/generate-checklist
Content-Type: application/json

{
  "year": 2026,
  "month": 2,
  "prison_name": "女子监狱",
  "checklistData": []  // 可选，优先从数据库读取
}
```

**响应**：Word文档文件流

## ✅ 数据统一验证

### 前端可编辑字段
- 报告清单页面：16个项目 × 3个字段（content, situation, check_time）

### 数据库字段
- report_checklist_items 表：3个可编辑字段（content, situation, check_time）

### Word模板占位符
- 35个占位符：3个基本信息 + 16个项目 × 2个字段（content, status）

### 一致性
✅ **100%一致**
- 用户编辑的每个字段都对应数据库的一个字段
- 数据库的每个字段都对应Word模板的一个占位符
- 下载Word时从数据库读取数据填充模板

## 🎯 使用流程

### 1. 编辑清单
1. 打开报告清单页面
2. 选择监狱和月份
3. 点击某个项目的"编辑"按钮
4. 填写"报告内容"和"检察情况"
5. 点击"保存"
6. 数据保存到 report_checklist_items 表

### 2. 自动填充
- 系统会根据 daily_logs、weekly_records、monthly_records 等表自动生成部分内容
- 用户可以手动编辑覆盖自动生成的内容

### 3. 下载清单
1. 点击"下载Word"按钮
2. 系统从数据库读取16个项目的数据
3. 填充Word模板的35个占位符
4. 生成并下载文档

### 4. 验证数据
- 打开下载的Word文档
- 检查16个项目的内容是否正确
- 特别检查用户手动编辑的项目

## ⚠️ 注意事项

1. **数据隔离**：每个监狱、每个月份的清单数据是独立的
2. **唯一索引**：同一监狱、同一月份、同一项目只能有一条记录
3. **自动生成 vs 手动编辑**：
   - 自动生成：从日志表统计生成
   - 手动编辑：用户点击"编辑"保存到数据库
   - 优先级：手动编辑 > 自动生成
4. **字段为空**：如果某个项目没有数据，Word模板会显示空白

## 🚀 测试步骤

1. 打开报告清单页面
2. 选择"女子监狱"和"2026-02"
3. 编辑项目7（监控检察）
4. 填写内容："本月共抽查监控 15 次"
5. 填写情况："未发现异常"
6. 保存
7. 点击"下载Word"
8. 打开Word文档
9. 验证项目7的内容是否正确显示

---

**完成时间**: 2026-02-03
**状态**: ✅ 已统一
